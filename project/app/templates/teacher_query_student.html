{% extends 'base.html' %}
{% block content %}
<style>
  .main-container {
    background: #fff;
    max-width: 30vw;
    margin: 48px auto 0 auto;
    border-radius: 14px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.08);
    padding: 36px 40px 32px 40px;
  }
  h1 {
    color: #2d3a4b;
    margin-bottom: 28px;
    text-align: center;
    font-size: 1.6em;
    letter-spacing: 1px;
  }
  .form-row {
    display: flex;
    align-items: center;
    margin-bottom: 18px;
  }
  label {
    width: 90px;
    font-weight: bold;
    color: #444;
    margin-right: 10px;
  }
  input[type="text"] {
    flex: 1;
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 15px;
  }
  button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 500;
    color: white;
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    cursor: pointer;
    margin-top: 10px;
  }
  .result-box {
    margin-top: 30px;
    padding: 20px;
    background-color: #f9f9f9;
    border-radius: 5px;
  }
</style>
<div class="main-container">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h1 style="margin-bottom:0;">Query One Student Record</h1>
    <a href="{{ url_for('teacher.dashboard') }}">
      <button type="button" style="background:#6c757d;color:white;padding:8px 18px;border:none;border-radius:6px;cursor:pointer;margin-left:20px;">‚Üê Back to Dashboard</button>
    </a>
  </div>
  {% with msgs = get_flashed_messages() %}
    {% if msgs %}
      <div class="alert alert-warning">{{ msgs[-1] }}</div>
    {% endif %}
  {% endwith %}
  <form method="post">
    {% if configs and configs|length > 0 %}
    <div class="form-row">
      <label>API:</label>
      <select name="api_choice" style="flex:1;padding:8px 10px;border-radius:6px;border:1px solid #ccc;font-size:15px;">
        <option value="auto" {% if api_choice=='auto' %}selected{% endif %}>Auto (try all)</option>
        {% for c in configs %}
        <option value="{{ c.id }}" {% if api_choice==c.id|string %}selected{% endif %}>{{ c.base_url }}{{ c.path }}</option>
        {% endfor %}
      </select>
    </div>
    {% endif %}
    <div class="form-row">
      <label>Name:</label>
      <input type="text" name="name" value="{{ name|default('') }}" required>
    </div>
    <div class="form-row">
      <label>Student ID:</label>
      <input type="text" name="id" value="{{ stu_id|default('') }}" required>
    </div>
    <button type="submit">Query</button>
  </form>
  {% if result %}
    <div class="result-box">
      <h3>Query Result</h3>
      {% if result.status in ['y', 'success'] %}
        <p><strong>Student:</strong> {{ result.name }} ({{ result.id }})</p>
        <p><strong>Major:</strong> {{ result.major }}</p>
        <p><strong>GPA:</strong> {{ result.gpa }}</p>
        {% if result.rank %}<p><strong>Rank:</strong> {{ result.rank }}</p>{% endif %}
        {% if result.courses %}
        <h4>Course Details</h4>
        <table class="score-table">
          <thead>
            <tr>
              <th>Course Code</th>
              <th>Course Name</th>
              <th>Credits</th>
              <th>Score</th>
              <th>Grade</th>
            </tr>
          </thead>
          <tbody>
            {% for course in result.courses %}
            <tr>
              <td>{{ course.code }}</td>
              <td>{{ course.name }}</td>
              <td>{{ course.credits }}</td>
              <td>{{ course.score }}</td>
              <td>{{ course.grade }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      {% elif result.status == 'error' %}
        <div style="color:red"><strong>Error:</strong> {{ result.message }}</div>
      {% else %}
        <div>No record found or query failed.</div>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
